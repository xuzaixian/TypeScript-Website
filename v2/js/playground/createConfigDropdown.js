define(["require", "exports"], function (require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    exports.createConfigDropdown = (sandbox, monaco) => {
        const configContainer = document.getElementById('config-container');
        const container = document.createElement('div');
        container.id = 'boolean-options-container';
        configContainer.appendChild(container);
        const compilerOpts = sandbox.getCompilerOptions();
        const boolOptions = Object.keys(sandbox.getCompilerOptions()).filter(k => typeof compilerOpts[k] === 'boolean');
        // we want to make sections of categories
        const categoryMap = {};
        boolOptions.forEach(optID => {
            const summary = optionsSummary.find(sum => optID === sum.id);
            const existingCategory = categoryMap[summary.categoryID];
            if (!existingCategory)
                categoryMap[summary.categoryID] = {};
            categoryMap[summary.categoryID][optID] = summary;
        });
        Object.keys(categoryMap).forEach(categoryID => {
            const categoryDiv = document.createElement('div');
            const header = document.createElement('h4');
            const ol = document.createElement('ol');
            Object.keys(categoryMap[categoryID]).forEach(optID => {
                const optSummary = categoryMap[categoryID][optID];
                header.textContent = optSummary.categoryDisplay;
                const li = document.createElement('li');
                const label = document.createElement('label');
                label.innerHTML = `<span>${optSummary.id}</span><br/>${optSummary.oneliner}`;
                const input = document.createElement('input');
                input.value = optSummary.id;
                input.type = 'checkbox';
                input.name = optSummary.id;
                input.id = 'option-' + optSummary.id;
                input.onchange = () => {
                    sandbox.updateCompilerSetting(optSummary.id, input.checked);
                };
                label.htmlFor = input.id;
                li.appendChild(input);
                li.appendChild(label);
                ol.appendChild(li);
            });
            categoryDiv.appendChild(header);
            categoryDiv.appendChild(ol);
            container.appendChild(categoryDiv);
        });
        const dropdownContainer = document.getElementById('compiler-dropdowns');
        const target = optionsSummary.find(sum => sum.id === 'target');
        const targetSwitch = createSelect(target.display, 'target', target.oneliner, sandbox, monaco.languages.typescript.ScriptTarget);
        dropdownContainer.appendChild(targetSwitch);
        const jsx = optionsSummary.find(sum => sum.id === 'jsx');
        const jsxSwitch = createSelect(jsx.display, 'jsx', jsx.oneliner, sandbox, monaco.languages.typescript.JsxEmit);
        dropdownContainer.appendChild(jsxSwitch);
        const modSum = optionsSummary.find(sum => sum.id === 'module');
        const moduleSwitch = createSelect(modSum.display, 'module', modSum.oneliner, sandbox, monaco.languages.typescript.ModuleKind);
        dropdownContainer.appendChild(moduleSwitch);
    };
    exports.updateConfigDropdownForCompilerOptions = (sandbox, monaco) => {
        const compilerOpts = sandbox.getCompilerOptions();
        const boolOptions = Object.keys(sandbox.getCompilerOptions()).filter(k => typeof compilerOpts[k] === 'boolean');
        boolOptions.forEach(opt => {
            const inputID = 'option-' + opt;
            const input = document.getElementById(inputID);
            input.checked = !!compilerOpts[opt];
        });
        const compilerIDToMaps = {
            module: monaco.languages.typescript.ModuleKind,
            jsx: monaco.languages.typescript.JsxEmit,
            target: monaco.languages.typescript.ScriptTarget,
        };
        Object.keys(compilerIDToMaps).forEach(flagID => {
            const input = document.getElementById('compiler-select-' + flagID);
            const currentValue = compilerOpts[flagID];
            const map = compilerIDToMaps[flagID];
            // @ts-ignore
            const realValue = map[currentValue];
            // @ts-ignore
            for (const option of input.children) {
                option.selected = option.value.toLowerCase() === realValue.toLowerCase();
            }
        });
    };
    const createSelect = (title, id, blurb, sandbox, option) => {
        const label = document.createElement('label');
        const textToDescribe = document.createElement('span');
        textToDescribe.textContent = title + ':';
        label.appendChild(textToDescribe);
        const select = document.createElement('select');
        select.id = 'compiler-select-' + id;
        label.appendChild(select);
        select.onchange = () => {
            const value = select.value; // the human string
            const compilerIndex = option[value];
            sandbox.updateCompilerSetting(id, compilerIndex);
        };
        Object.keys(option)
            .filter(key => isNaN(Number(key)))
            .forEach(key => {
            // hide Latest
            if (key === 'Latest')
                return;
            const option = document.createElement('option');
            option.value = key;
            option.text = key;
            select.appendChild(option);
        });
        const span = document.createElement('span');
        span.textContent = blurb;
        span.classList.add('compiler-flag-blurb');
        label.appendChild(span);
        return label;
    };
    exports.setupJSONToggleForConfig = (sandbox) => { };
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3JlYXRlQ29uZmlnRHJvcGRvd24uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9wbGF5Z3JvdW5kL3NyYy9jcmVhdGVDb25maWdEcm9wZG93bi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7SUFlYSxRQUFBLG9CQUFvQixHQUFHLENBQUMsT0FBZ0IsRUFBRSxNQUFjLEVBQUUsRUFBRTtRQUN2RSxNQUFNLGVBQWUsR0FBRyxRQUFRLENBQUMsY0FBYyxDQUFDLGtCQUFrQixDQUFFLENBQUE7UUFDcEUsTUFBTSxTQUFTLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQTtRQUMvQyxTQUFTLENBQUMsRUFBRSxHQUFHLDJCQUEyQixDQUFBO1FBQzFDLGVBQWUsQ0FBQyxXQUFXLENBQUMsU0FBUyxDQUFDLENBQUE7UUFFdEMsTUFBTSxZQUFZLEdBQUcsT0FBTyxDQUFDLGtCQUFrQixFQUFFLENBQUE7UUFDakQsTUFBTSxXQUFXLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsa0JBQWtCLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLE9BQU8sWUFBWSxDQUFDLENBQUMsQ0FBQyxLQUFLLFNBQVMsQ0FBQyxDQUFBO1FBRS9HLHlDQUF5QztRQUN6QyxNQUFNLFdBQVcsR0FBRyxFQUFpRSxDQUFBO1FBQ3JGLFdBQVcsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEVBQUU7WUFDMUIsTUFBTSxPQUFPLEdBQUcsY0FBYyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEtBQUssS0FBSyxHQUFHLENBQUMsRUFBRSxDQUFFLENBQUE7WUFFN0QsTUFBTSxnQkFBZ0IsR0FBRyxXQUFXLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFBO1lBQ3hELElBQUksQ0FBQyxnQkFBZ0I7Z0JBQUUsV0FBVyxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsR0FBRyxF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QUFDLENBQUE7UUFDM0MsSUFBSSxDQUFDLFdBQVcsR0FBRyxLQUFLLENBQUE7UUFDeEIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMscUJBQXFCLENBQUMsQ0FBQTtRQUN6QyxLQUFLLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFBO1FBRXZCLE9BQU8sS0FBSyxDQUFBO0lBQ2QsQ0FBQyxDQUFBO0lBRVksUUFBQSx3QkFBd0IsR0FBRyxDQUFDLE9BQWdCLEVBQUUsRUFBRSxHQUFFLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBsYXlncm91bmQgfSBmcm9tICcuJ1xuXG50eXBlIFNhbmRib3ggPSBSZXR1cm5UeXBlPHR5cGVvZiBpbXBvcnQoJ3R5cGVzY3JpcHQtc2FuZGJveCcpLmNyZWF0ZVR5cGVTY3JpcHRTYW5kYm94PlxudHlwZSBNb25hY28gPSB0eXBlb2YgaW1wb3J0KCdtb25hY28tZWRpdG9yJylcblxudHlwZSBPcHRpb25zU3VtbWFyeSA9IHtcbiAgZGlzcGxheTogc3RyaW5nXG4gIG9uZWxpbmVyOiBzdHJpbmdcbiAgaWQ6IHN0cmluZ1xuICBjYXRlZ29yeUlEOiBzdHJpbmdcbiAgY2F0ZWdvcnlEaXNwbGF5OiBzdHJpbmdcbn1cblxuZGVjbGFyZSBjb25zdCBvcHRpb25zU3VtbWFyeTogT3B0aW9uc1N1bW1hcnlbXVxuXG5leHBvcnQgY29uc3QgY3JlYXRlQ29uZmlnRHJvcGRvd24gPSAoc2FuZGJveDogU2FuZGJveCwgbW9uYWNvOiBNb25hY28pID0+IHtcbiAgY29uc3QgY29uZmlnQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbmZpZy1jb250YWluZXInKSFcbiAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JylcbiAgY29udGFpbmVyLmlkID0gJ2Jvb2xlYW4tb3B0aW9ucy1jb250YWluZXInXG4gIGNvbmZpZ0NvbnRhaW5lci5hcHBlbmRDaGlsZChjb250YWluZXIpXG5cbiAgY29uc3QgY29tcGlsZXJPcHRzID0gc2FuZGJveC5nZXRDb21waWxlck9wdGlvbnMoKVxuICBjb25zdCBib29sT3B0aW9ucyA9IE9iamVjdC5rZXlzKHNhbmRib3guZ2V0Q29tcGlsZXJPcHRpb25zKCkpLmZpbHRlcihrID0+IHR5cGVvZiBjb21waWxlck9wdHNba10gPT09ICdib29sZWFuJylcblxuICAvLyB3ZSB3YW50IHRvIG1ha2Ugc2VjdGlvbnMgb2YgY2F0ZWdvcmllc1xuICBjb25zdCBjYXRlZ29yeU1hcCA9IHt9IGFzIHsgW2NhdGVnb3J5OiBzdHJpbmddOiB7IFtvcHRJRDogc3RyaW5nXTogT3B0aW9uc1N1bW1hcnkgfSB9XG4gIGJvb2xPcHRpb25zLmZvckVhY2gob3B0SUQgPT4ge1xuICAgIGNvbnN0IHN1bW1hcnkgPSBvcHRpb25zU3VtbWFyeS5maW5kKHN1bSA9PiBvcHRJRCA9PT0gc3VtLmlkKSFcblxuICAgIGNvbnN0IGV4aXN0aW5nQ2F0ZWdvcnkgPSBjYXRlZ29yeU1hcFtzdW1tYXJ5LmNhdGVnb3J5SURdXG4gICAgaWYgKCFleGlzdGluZ0NhdGVnb3J5KSBjYXRlZ29yeU1hcFtzdW1tYXJ5LmNhdGVnb3J5SURdID0ge31cblxuICAgIGNhdGVnb3J5TWFwW3N1bW1hcnkuY2F0ZWdvcnlJRF1bb3B0SURdID0gc3VtbWFyeVxuICB9KVxuXG4gIE9iamVjdC5rZXlzKGNhdGVnb3J5TWFwKS5mb3JFYWNoKGNhdGVnb3J5SUQgPT4ge1xuICAgIGNvbnN0IGNhdGVnb3J5RGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JylcbiAgICBjb25zdCBoZWFkZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoNCcpXG4gICAgY29uc3Qgb2wgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvbCcpXG5cbiAgICBPYmplY3Qua2V5cyhjYXRlZ29yeU1hcFtjYXRlZ29yeUlEXSkuZm9yRWFjaChvcHRJRCA9PiB7XG4gICAgICBjb25zdCBvcHRTdW1tYXJ5ID0gY2F0ZWdvcnlNYXBbY2F0ZWdvcnlJRF1bb3B0SURdXG4gICAgICBoZWFkZXIudGV4dENvbnRlbnQgPSBvcHRTdW1tYXJ5LmNhdGVnb3J5RGlzcGxheVxuXG4gICAgICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJylcbiAgICAgIGNvbnN0IGxhYmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGFiZWwnKVxuICAgICAgbGFiZWwuaW5uZXJIVE1MID0gYDxzcGFuPiR7b3B0U3VtbWFyeS5pZH08L3NwYW4+PGJyLz4ke29wdFN1bW1hcnkub25lbGluZXJ9YFxuXG4gICAgICBjb25zdCBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0JylcbiAgICAgIGlucHV0LnZhbHVlID0gb3B0U3VtbWFyeS5pZFxuICAgICAgaW5wdXQudHlwZSA9ICdjaGVja2JveCdcbiAgICAgIGlucHV0Lm5hbWUgPSBvcHRTdW1tYXJ5LmlkXG4gICAgICBpbnB1dC5pZCA9ICdvcHRpb24tJyArIG9wdFN1bW1hcnkuaWRcblxuICAgICAgaW5wdXQub25jaGFuZ2UgPSAoKSA9PiB7XG4gICAgICAgIHNhbmRib3gudXBkYXRlQ29tcGlsZXJTZXR0aW5nKG9wdFN1bW1hcnkuaWQsIGlucHV0LmNoZWNrZWQpXG4gICAgICB9XG5cbiAgICAgIGxhYmVsLmh0bWxGb3IgPSBpbnB1dC5pZFxuXG4gICAgICBsaS5hcHBlbmRDaGlsZChpbnB1dClcbiAgICAgIGxpLmFwcGVuZENoaWxkKGxhYmVsKVxuICAgICAgb2wuYXBwZW5kQ2hpbGQobGkpXG4gICAgfSlcblxuICAgIGNhdGVnb3J5RGl2LmFwcGVuZENoaWxkKGhlYWRlcilcbiAgICBjYXRlZ29yeURpdi5hcHBlbmRDaGlsZChvbClcbiAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoY2F0ZWdvcnlEaXYpXG4gIH0pXG5cbiAgY29uc3QgZHJvcGRvd25Db250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29tcGlsZXItZHJvcGRvd25zJykhXG5cbiAgY29uc3QgdGFyZ2V0ID0gb3B0aW9uc1N1bW1hcnkuZmluZChzdW0gPT4gc3VtLmlkID09PSAndGFyZ2V0JykhXG4gIGNvbnN0IHRhcmdldFN3aXRjaCA9IGNyZWF0ZVNlbGVjdChcbiAgICB0YXJnZXQuZGlzcGxheSxcbiAgICAndGFyZ2V0JyxcbiAgICB0YXJnZXQub25lbGluZXIsXG4gICAgc2FuZGJveCxcbiAgICBtb25hY28ubGFuZ3VhZ2VzLnR5cGVzY3JpcHQuU2NyaXB0VGFyZ2V0XG4gIClcbiAgZHJvcGRvd25Db250YWluZXIuYXBwZW5kQ2hpbGQodGFyZ2V0U3dpdGNoKVxuXG4gIGNvbnN0IGpzeCA9IG9wdGlvbnNTdW1tYXJ5LmZpbmQoc3VtID0+IHN1bS5pZCA9PT0gJ2pzeCcpIVxuICBjb25zdCBqc3hTd2l0Y2ggPSBjcmVhdGVTZWxlY3QoanN4LmRpc3BsYXksICdqc3gnLCBqc3gub25lbGluZXIsIHNhbmRib3gsIG1vbmFjby5sYW5ndWFnZXMudHlwZXNjcmlwdC5Kc3hFbWl0KVxuICBkcm9wZG93bkNvbnRhaW5lci5hcHBlbmRDaGlsZChqc3hTd2l0Y2gpXG5cbiAgY29uc3QgbW9kU3VtID0gb3B0aW9uc1N1bW1hcnkuZmluZChzdW0gPT4gc3VtLmlkID09PSAnbW9kdWxlJykhXG4gIGNvbnN0IG1vZHVsZVN3aXRjaCA9IGNyZWF0ZVNlbGVjdChcbiAgICBtb2RTdW0uZGlzcGxheSxcbiAgICAnbW9kdWxlJyxcbiAgICBtb2RTdW0ub25lbGluZXIsXG4gICAgc2FuZGJveCxcbiAgICBtb25hY28ubGFuZ3VhZ2VzLnR5cGVzY3JpcHQuTW9kdWxlS2luZFxuICApXG4gIGRyb3Bkb3duQ29udGFpbmVyLmFwcGVuZENoaWxkKG1vZHVsZVN3aXRjaClcbn1cblxuZXhwb3J0IGNvbnN0IHVwZGF0ZUNvbmZpZ0Ryb3Bkb3duRm9yQ29tcGlsZXJPcHRpb25zID0gKHNhbmRib3g6IFNhbmRib3gsIG1vbmFjbzogTW9uYWNvKSA9PiB7XG4gIGNvbnN0IGNvbXBpbGVyT3B0cyA9IHNhbmRib3guZ2V0Q29tcGlsZXJPcHRpb25zKClcbiAgY29uc3QgYm9vbE9wdGlvbnMgPSBPYmplY3Qua2V5cyhzYW5kYm94LmdldENvbXBpbGVyT3B0aW9ucygpKS5maWx0ZXIoayA9PiB0eXBlb2YgY29tcGlsZXJPcHRzW2tdID09PSAnYm9vbGVhbicpXG5cbiAgYm9vbE9wdGlvbnMuZm9yRWFjaChvcHQgPT4ge1xuICAgIGNvbnN0IGlucHV0SUQgPSAnb3B0aW9uLScgKyBvcHRcbiAgICBjb25zdCBpbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlucHV0SUQpIGFzIEhUTUxJbnB1dEVsZW1lbnRcbiAgICBpbnB1dC5jaGVja2VkID0gISFjb21waWxlck9wdHNbb3B0XVxuICB9KVxuXG4gIGNvbnN0IGNvbXBpbGVySURUb01hcHM6IGFueSA9IHtcbiAgICBtb2R1bGU6IG1vbmFjby5sYW5ndWFnZXMudHlwZXNjcmlwdC5Nb2R1bGVLaW5kLFxuICAgIGpzeDogbW9uYWNvLmxhbmd1YWdlcy50eXBlc2NyaXB0LkpzeEVtaXQsXG4gICAgdGFyZ2V0OiBtb25hY28ubGFuZ3VhZ2VzLnR5cGVzY3JpcHQuU2NyaXB0VGFyZ2V0LFxuICB9XG5cbiAgT2JqZWN0LmtleXMoY29tcGlsZXJJRFRvTWFwcykuZm9yRWFjaChmbGFnSUQgPT4ge1xuICAgIGNvbnN0IGlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbXBpbGVyLXNlbGVjdC0nICsgZmxhZ0lEKSBhcyBIVE1MSW5wdXRFbGVtZW50XG4gICAgY29uc3QgY3VycmVudFZhbHVlID0gY29tcGlsZXJPcHRzW2ZsYWdJRF1cbiAgICBjb25zdCBtYXAgPSBjb21waWxlcklEVG9NYXBzW2ZsYWdJRF1cbiAgICAvLyBAdHMtaWdub3JlXG4gICAgY29uc3QgcmVhbFZhbHVlID0gbWFwW2N1cnJlbnRWYWx1ZV1cbiAgICAvLyBAdHMtaWdub3JlXG4gICAgZm9yIChjb25zdCBvcHRpb24gb2YgaW5wdXQuY2hpbGRyZW4pIHtcbiAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IG9wdGlvbi52YWx1ZS50b0xvd2VyQ2FzZSgpID09PSByZWFsVmFsdWUudG9Mb3dlckNhc2UoKVxuICAgIH1cbiAgfSlcbn1cblxuY29uc3QgY3JlYXRlU2VsZWN0ID0gKHRpdGxlOiBzdHJpbmcsIGlkOiBzdHJpbmcsIGJsdXJiOiBzdHJpbmcsIHNhbmRib3g6IFNhbmRib3gsIG9wdGlvbjogYW55KSA9PiB7XG4gIGNvbnN0IGxhYmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGFiZWwnKVxuICBjb25zdCB0ZXh0VG9EZXNjcmliZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKVxuICB0ZXh0VG9EZXNjcmliZS50ZXh0Q29udGVudCA9IHRpdGxlICsgJzonXG4gIGxhYmVsLmFwcGVuZENoaWxkKHRleHRUb0Rlc2NyaWJlKVxuXG4gIGNvbnN0IHNlbGVjdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NlbGVjdCcpXG4gIHNlbGVjdC5pZCA9ICdjb21waWxlci1zZWxlY3QtJyArIGlkXG4gIGxhYmVsLmFwcGVuZENoaWxkKHNlbGVjdClcblxuICBzZWxlY3Qub25jaGFuZ2UgPSAoKSA9PiB7XG4gICAgY29uc3QgdmFsdWUgPSBzZWxlY3QudmFsdWUgLy8gdGhlIGh1bWFuIHN0cmluZ1xuICAgIGNvbnN0IGNvbXBpbGVySW5kZXggPSBvcHRpb25bdmFsdWVdXG4gICAgc2FuZGJveC51cGRhdGVDb21waWxlclNldHRpbmcoaWQsIGNvbXBpbGVySW5kZXgpXG4gIH1cblxuICBPYmplY3Qua2V5cyhvcHRpb24pXG4gICAgLmZpbHRlcihrZXkgPT4gaXNOYU4oTnVtYmVyKGtleSkpKVxuICAgIC5mb3JFYWNoKGtleSA9PiB7XG4gICAgICAvLyBoaWRlIExhdGVzdFxuICAgICAgaWYgKGtleSA9PT0gJ0xhdGVzdCcpIHJldHVyblxuXG4gICAgICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKVxuICAgICAgb3B0aW9uLnZhbHVlID0ga2V5XG4gICAgICBvcHRpb24udGV4dCA9IGtleVxuXG4gICAgICBzZWxlY3QuYXBwZW5kQ2hpbGQob3B0aW9uKVxuICAgIH0pXG5cbiAgY29uc3Qgc3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKVxuICBzcGFuLnRleHRDb250ZW50ID0gYmx1cmJcbiAgc3Bhbi5jbGFzc0xpc3QuYWRkKCdjb21waWxlci1mbGFnLWJsdXJiJylcbiAgbGFiZWwuYXBwZW5kQ2hpbGQoc3BhbilcblxuICByZXR1cm4gbGFiZWxcbn1cblxuZXhwb3J0IGNvbnN0IHNldHVwSlNPTlRvZ2dsZUZvckNvbmZpZyA9IChzYW5kYm94OiBTYW5kYm94KSA9PiB7fVxuIl19